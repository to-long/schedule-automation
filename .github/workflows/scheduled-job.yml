name: Scheduled Job

on:
  schedule:
    # Check-in: 8:45 AM UTC+7 (1:45 AM UTC)
    - cron: '45 1 * * *'
    # Check-out: 6:00 PM UTC+7 (11:00 AM UTC)
    - cron: '0 11 * * *'
  
  # Allow manual trigger for testing
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to run'
        required: true
        default: 'in'
        type: choice
        options:
          - in
          - out

jobs:
  check-in:
    runs-on: ubuntu-latest
    if: github.event.schedule == '45 8 * * *' || (github.event_name == 'workflow_dispatch' && github.event.inputs.action == 'in')
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install

      - name: Run check-in
        run: npx tsx scripts/check-attendance.ts in

  check-out:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 18 * * *' || (github.event_name == 'workflow_dispatch' && github.event.inputs.action == 'out')
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install

      - name: Run check-out
        run: npx tsx scripts/check-attendance.ts out
